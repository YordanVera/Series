{"version":3,"sources":["../../source/server/router/routes/links/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import * as express         from \"express\";\r\nimport * as _               from 'lodash';\r\nimport * as request         from 'request';\r\nimport * as cheerio         from 'cheerio';\r\nimport * as Rx              from 'rxjs/Rx';\r\nimport { extratorrent }     from './extratorrent';\r\nimport { thepiratebay }     from './thepiratebay'; \r\nimport { subdivx }          from './subdivx';\r\nimport { _group_list }      from './groups';\r\n\r\nexport class links_routes {\r\n    private _app            : express.Express;\r\n    private extratorrent    : extratorrent;\r\n    private thepiratebay    : thepiratebay;\r\n    private subdivx         : subdivx;\r\n\r\n    constructor(app){\r\n        this._app           = app;\r\n        this.extratorrent   = new extratorrent();\r\n        this.thepiratebay   = new thepiratebay();\r\n        this.subdivx        = new subdivx();\r\n        this.setRoutes();\r\n    }\r\n    public setRoutes(){\r\n        this.get_links();\r\n    }\r\n    private get_links(){\r\n        this._app.get('/get_links/:TVShow_name/:season/:episode', (req, res)=>{\r\n            if(!req.params){\r\n                res.sendStatus(400);\r\n            }else{\r\n                let TVShow_name = req.params.TVShow_name;\r\n                let season = req.params.season;\r\n                let episode = req.params.episode;\r\n                var _result = [];\r\n                //search in extratorrent\r\n                this.extratorrent.search(TVShow_name, season, episode)\r\n                    .flatMap(\r\n                        data => {\r\n                            //resultado de extratorrent se almacena en _result\r\n                            if(data !== 'no data'){\r\n                                _.forEach(data, (e)=>{\r\n                                    _result.push(e);\r\n                                });\r\n                            }\r\n                            //llamada a búsqueda en thepiratebay\r\n                            return this.thepiratebay.search(TVShow_name, season, episode);\r\n                        })\r\n                    .flatMap(\r\n                        data => {\r\n                            if(data !== 'no data'){\r\n                                _.forEach(data, (e)=>{\r\n                                    _result.push(e);\r\n                                });\r\n                            }\r\n                            //se obtiene grupo realease por cada link\r\n                            _result = this.groups_release(_result);\r\n                            //se obtienen las resoluciones por cada link \r\n                            _result = this.get_resolution(_result);\r\n                            //se genera la búsqueda de subtítulos, pasando el conjunto de links\r\n                            return this.subdivx.search(_result, TVShow_name, season, episode);\r\n                        })\r\n                    .subscribe(data => {                    \r\n                        if(_result.length>0){\r\n                            _result = this.format_links(_result);\r\n                            _result = _.orderBy(_result, ['group'], ['asc']);\r\n                            //realizar matching entre enlaces y subtítulos\r\n                            let final_result = this.match_links_subs(_result, data);\r\n                            return res.json({success: true, result: final_result});\r\n                        }else{\r\n                            return res.json({success: false, error: 'no data'});\r\n                        }\r\n\r\n                    }, error => {\r\n                        return res.json({success: false, error: error});\r\n                    });\r\n            }\r\n        });\r\n    }\r\n    protected groups_release(links){\r\n        let _links = links;\r\n        _.forEach(_links, (element, index)=>{\r\n            _.forEach(_group_list, (group)=>{\r\n                let name : string = _.lowerCase(element.name);\r\n                let grupo : string = group;\r\n                if(name.indexOf(grupo) !== -1){\r\n                    _links[index][\"group\"] = grupo;\r\n                }\r\n            });\r\n        });\r\n        return _links;\r\n    }\r\n    protected get_resolution(links){\r\n        let _links = [];\r\n        _.forEach(links, (element, index)=>{\r\n            if(element.name.indexOf('1080')!==-1){\r\n                let e = element;\r\n                e['res'] = '1080';\r\n                _links.push(e);\r\n            }else{\r\n                if(element.name.indexOf('720')!==-1){\r\n                    let e = element;\r\n                    e['res'] = '720';\r\n                    _links.push(e);\r\n                }else{\r\n                    _links.push(element);\r\n                }\r\n            }\r\n        });\r\n        return _links;\r\n    }\r\n    protected format_links(links){\r\n        let _links = [];\r\n        _.forEachRight(links, (element, index)=>{\r\n                    if(_links.length===0){\r\n                      _links.push({\r\n                        group:element.group,\r\n                        data:[\r\n                            element\r\n                        ]\r\n                      });\r\n\r\n                    }else{\r\n                      let pos = _.findIndex(_links, {'group':element.group});\r\n                      if(pos>-1){\r\n                        _links[pos].data.push(element);\r\n                      }else{\r\n                        _links.push({\r\n                        group:element.group,\r\n                        data:[\r\n                          element\r\n                        ]\r\n                      });\r\n                      }\r\n                    }\r\n                });\r\n        return _links;\r\n    }\r\n    protected match_links_subs(list_links, list_subs){\r\n        let links = list_links;\r\n        _.forEach(links, (element, index)=>{\r\n            element['subs']=[];\r\n            _.forEach(element.data, (elm, idx)=>{\r\n                if(elm.res === '1080' && typeof elm.group !== 'undefined'){\r\n                    _.forEach(list_subs, (e,i)=>{\r\n                        let idx_group = _.findIndex(e.groups, (group)=>{\r\n                            return group === element.group;\r\n                        });\r\n                        if(e.res_1080 && idx_group>-1){\r\n                            let idx_sub = _.findIndex(element.subs, {link:e.link});\r\n                            if(idx_sub<0){\r\n                                element.subs.push(e);\r\n                            }\r\n                        }\r\n                    });\r\n                }else if(elm.res === '1080' && typeof elm.group === 'undefined'){\r\n                    _.forEach(list_subs, (e,i)=>{\r\n                        if(e.res_1080 && e.groups.length === 0){\r\n                            let idx_sub = _.findIndex(element.subs, {link:e.link});\r\n                            if(idx_sub<0){\r\n                                element.subs.push(e);\r\n                            }\r\n                        }\r\n                    });\r\n                }else if(elm.res === '720' && typeof elm.group !== 'undefined'){\r\n                    _.forEach(list_subs, (e,i)=>{\r\n                        let idx_group = _.findIndex(e.groups, (group)=>{\r\n                            return group === element.group;\r\n                        });\r\n                        if(e.res_720 && idx_group>-1){\r\n                            let idx_sub = _.findIndex(element.subs, {link:e.link});\r\n                            if(idx_sub<0){\r\n                                element.subs.push(e);\r\n                            }\r\n                        }\r\n                    });\r\n                }else if(elm.res === '720' && typeof elm.group === 'undefined'){\r\n                    _.forEach(list_subs, (e,i)=>{\r\n                        if(e.res_720 && e.groups.length === 0){\r\n                            let idx_sub = _.findIndex(element.subs, {link:e.link});\r\n                            if(idx_sub<0){\r\n                                element.subs.push(e);\r\n                            }\r\n                        }\r\n                    });\r\n                }else if(typeof elm.res === 'undefined' && typeof elm.group !== 'undefined'){\r\n                    _.forEach(list_subs, (e,i)=>{\r\n                        let idx_group = _.findIndex(e.groups, (group)=>{\r\n                            return group === element.group;\r\n                        });\r\n                        if(idx_group>-1){\r\n                            let idx_sub = _.findIndex(element.subs, {link:e.link});\r\n                            if(idx_sub<0){\r\n                                element.subs.push(e);\r\n                            }\r\n                        }\r\n                    });\r\n                }else if(typeof elm.res === 'undefined' && typeof elm.group === 'undefined'){\r\n                    _.forEach(list_subs, (e,i)=>{\r\n                        if(e.groups.length===0){\r\n                            let idx_sub = _.findIndex(element.subs, {link:e.link});\r\n                            if(idx_sub<0){\r\n                                element.subs.push(e);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n        });\r\n        return links;\r\n    }\r\n}"]}