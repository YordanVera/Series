{"version":3,"sources":["../../source/server/router/routes/links/extratorrent.ts"],"names":[],"mappings":"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","file":"extratorrent.js","sourcesContent":["import * as _           from 'lodash';\r\nimport * as request     from 'request';\r\nimport * as cheerio     from 'cheerio';\r\nimport * as Rx          from 'rxjs/Rx';\r\n\r\nexport class extratorrent {\r\n    constructor(){}\r\n    public search(TVShow_name: string, season: number, episode: number){\r\n        let subject = new Rx.Subject();\r\n        let query = this.create_query(TVShow_name, season, episode);\r\n        let links = [];\r\n\r\n        request(query, (error, response, html)=>{\r\n            if(!error){\r\n                var $ = cheerio.load(html, {normalizeWhitespace: false, xmlMode: false, decodeEntities: true});\r\n                var _self = this;\r\n                //tabla con resultados\r\n                $('table .tl').filter(function(idx,element){\r\n                    $(this).filter(function(i,e){\r\n                        //se comprueba que hayan resultados, sino no hay data\r\n                        if(e.children.length>2){\r\n                            //contenido de la tabla\r\n                            _.forEach(e.children, (elem, index)=>{\r\n                                //solo tr (filas) \r\n                                if(elem.name === 'tr'){ \r\n                                    let _torrent = elem.children[0].children[0].attribs;\r\n                                    let _magnet = elem.children[0].children[1].attribs;\r\n                                    var _name = elem.children[2].children[3].attribs;\r\n                                    let _added = elem.children[3].children[0];\r\n                                    let _size = elem.children[4].children[0];\r\n                                    let _seeders = elem.children[5].children[0];\r\n                                    let _leechers = elem.children[6].children[0];\r\n                                    if(_.values(_name)[0] === 'c_tor'){ //caso especial\r\n                                        _name = elem.children[2].children[2].attribs;\r\n                                    }\r\n                                    var name = '';\r\n                                    var link = '';\r\n                                    if(typeof _name !== 'undefined'){\r\n                                        name = _.values(_name)[1].toString();\r\n                                        name = name.substring(5); //cut 'view '\r\n                                        name = name.substring(0,name.length-8); // cut ' torrent' \r\n                                        link = 'http://extratorrent.cc'+_.values(_name)[0].toString();\r\n                                    }else{\r\n                                        _name = elem.children[2].children[2].attribs;\r\n                                        name = _.values(_name)[1].toString();\r\n                                        name = name.substring(5); //cut 'view ' \r\n                                        name = name.substring(0,name.length-8); // cut ' torrent' \r\n                                        link = 'http://extratorrent.cc'+_.values(_name)[0].toString();\r\n                                    }\r\n                                    // console.log(name);\r\n                                    links.push({\r\n                                        'name'      :name,\r\n                                        'torrent'   :'http://extratorrent.cc'+_.values(_torrent)[0],\r\n                                        'link'      : link,\r\n                                        'magnet'    :_.values(_magnet)[0],\r\n                                        'added'     :_.values(_added)[0],\r\n                                        'size'      :_.values(_size)[0],\r\n                                        'seeders'   :_.values(_seeders)[0],\r\n                                        'leechers'  :_.values(_leechers)[0],\r\n                                        'site'      : 'ExtraTorrent'\r\n                                    });\r\n                                }\r\n                                if(index === (e.children.length-1)){\r\n                                    let res_links = _self.delete_duplicate(links);\r\n                                    subject.next(res_links);\r\n                                }\r\n                            });\r\n                        }else{\r\n                            subject.next('no data');\r\n                        }\r\n                        return true;\r\n                    });\r\n                    return true;\r\n                });\r\n            }else{\r\n                subject.error(error);\r\n            }\r\n        });\r\n        return subject;\r\n    } \r\n    protected create_query(TVShow_name: string, season: number, episode: number){\r\n        let cap = '';\r\n        if(season<=9 && episode<=9){\r\n            cap = 'S0'+season+'E0'+episode;\r\n        }else if(season<=9 && episode>9){\r\n            cap = 'S0'+season+'E'+episode;\r\n        }\r\n        else if(season>9 && episode<=9){\r\n            cap = 'S'+season+'E0'+episode;\r\n        }\r\n        else if(season>9 && episode>9){\r\n            cap = 'S'+season+'E'+episode;\r\n        }\r\n        return 'http://extratorrent.cc/search/?search='+TVShow_name+'+'+cap+'&s_cat=8&pp=&srt=seeds&order=desc';\r\n    }\r\n    protected delete_duplicate(links){\r\n        let _links = links;\r\n        let _finale_links = [];\r\n        _.forEach(_links, (element, index)=>{\r\n            if(_finale_links.length===0){\r\n                _finale_links.push(element);\r\n            }else{\r\n                var link_splited = _.split(element.link, '/'); \r\n                var link_id = link_splited[4];\r\n                var counter = 0;\r\n                _.forEach(_finale_links, (e, i)=>{\r\n                    var finale_link = _.split(e.link, '/'); \r\n                    var finale_link_id = finale_link[4];\r\n                    if(finale_link_id === link_id){\r\n                        counter++;\r\n                    }\r\n                });\r\n                if(counter===0){\r\n                    _finale_links.push(element);\r\n                }\r\n            }\r\n        });\r\n        return _finale_links;\r\n    }\r\n}"]}