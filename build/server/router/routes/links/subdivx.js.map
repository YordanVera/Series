{"version":3,"sources":["../../source/server/router/routes/links/subdivx.ts"],"names":[],"mappings":"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","file":"subdivx.js","sourcesContent":["import * as _           from 'lodash';\r\nimport * as request     from 'request';\r\nimport * as cheerio     from 'cheerio';\r\nimport * as Rx          from 'rxjs/Rx';\r\nimport { _group_list }  from './groups';\r\n\r\nexport class subdivx {\r\n    constructor(){}\r\n    public search(links, TVShow_name: string, season: number, episode: number){\r\n        let subject = new Rx.Subject();\r\n        let url = this.create_url(TVShow_name, season, episode);\r\n        request(url, (error, response, html)=>{\r\n            if(!error){\r\n                var $ = cheerio.load(html, {normalizeWhitespace: false, xmlMode: false, decodeEntities: true});\r\n                var _self = this;\r\n                var contenedor_izq = [];\r\n                $('#contenedor_izq')\r\n                .children('div')\r\n                .filter(function(idx, element){\r\n                    _.forEach(element.children, (element, index)=>{\r\n                        if(element.name === 'div' && element.type === 'tag'){\r\n                            contenedor_izq.push(element);\r\n                        }\r\n                    });\r\n                    return true;\r\n                });\r\n                var _case = 0;\r\n                var list_subtitles = [];\r\n                var _subtitle = null;\r\n                _.forEach(contenedor_izq, (element, index)=>{\r\n                    switch (_case){\r\n                        //inicia el subtitulo, y obtiene el link del subtitulo\r\n                        case 0:{\r\n                            _subtitle = {\r\n                                href : null,\r\n                                desc : null,\r\n                                link : null\r\n                            };\r\n                            if(element.attribs.id === 'menu_titulo_buscador'){\r\n                                if(element.children[0].attribs.class === 'titulo_menu_izq'){\r\n                                    _subtitle.href = element.children[0].attribs.href;\r\n                                    _case++;\r\n                                }\r\n                            }\r\n                        }\r\n                        //obtiene la descripción del subtitulo\r\n                        case 1:{ \r\n                            if(element.attribs.id === 'buscador_detalle_sub'){\r\n                                if(element.children[0].type==='text'){\r\n                                    _subtitle.desc=element.children[0].data;\r\n                                    _case++;\r\n                                }\r\n                            }\r\n                        }\r\n                        //obtiene el link de descarga del subtitulo y reinicia el _case\r\n                        case 2:{\r\n                            if(element.attribs.id === 'buscador_detalle_sub_datos'){\r\n                                let last_child = element.children[element.children.length-1];\r\n                                if(last_child.type === 'tag' && last_child.name === 'a'){\r\n                                    _subtitle.link=last_child.attribs.href;\r\n                                    _case=0;\r\n                                    list_subtitles.push(_subtitle);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n                list_subtitles = this.get_resolution(list_subtitles);\r\n                list_subtitles = this.get_groups(list_subtitles);\r\n                subject.next(list_subtitles);\r\n            }\r\n        });\r\n        return subject;\r\n    }\r\n    protected create_url(TVShow_name: string, season: number, episode: number){\r\n        let cap = '';\r\n        if(season<=9 && episode<=9){\r\n            cap = 'S0'+season+'E0'+episode;\r\n        }else if(season<=9 && episode>9){\r\n            cap = 'S0'+season+'E'+episode;\r\n        }\r\n        else if(season>9 && episode<=9){\r\n            cap = 'S'+season+'E0'+episode;\r\n        }\r\n        else if(season>9 && episode>9){\r\n            cap = 'S'+season+'E'+episode;\r\n        }\r\n        return 'http://www.subdivx.com/index.php?buscar='+TVShow_name+'+'+cap+'&accion=5&masdesc=&subtitulos=1&realiza_b=1';\r\n    }\r\n    protected get_resolution(list_subs){\r\n        let _list = [];\r\n        _.forEach(list_subs, (e, i)=>{\r\n            let sub = e;\r\n            let idx_1080 = e.desc.indexOf('1080');\r\n            if(idx_1080>-1){\r\n                sub['res_1080'] = true;\r\n                let idx_720 = e.desc.indexOf('720');\r\n                if(idx_720>-1){\r\n                    sub['res_720'] = true;\r\n                }else{\r\n                    sub['res_720'] = false;\r\n                }\r\n            }else{\r\n                sub['res_1080'] = false;\r\n                let idx_720 = e.desc.indexOf('720');\r\n                if(idx_720>-1){\r\n                    sub['res_720'] = true;\r\n                }else{\r\n                    sub['res_720'] = false;\r\n                }\r\n            }\r\n            _list.push(sub);\r\n        });\r\n        return _list;\r\n    }\r\n    protected get_groups(list_subs){\r\n        let _list = [];\r\n        _.forEach(list_subs, (element, index)=>{\r\n            let sub = element;\r\n            sub['groups'] = [];\r\n            //se busca si hay un grupo\r\n            _.forEach(_group_list, (e, i)=>{\r\n                //si existe una coincidencia \r\n                if(element.desc.indexOf(e)>-1){\r\n                    //se verifica que no este guardado el grupo\r\n                    let idx = _.findIndex(sub.groups, e);\r\n                    //de no estar, se guarda en la lista del groups del subtítulo.\r\n                    if(idx===-1){\r\n                        sub.groups.push(e);\r\n                    }\r\n                }\r\n            });\r\n            _list.push(sub);\r\n        });\r\n        return _list;\r\n    }\r\n}"]}