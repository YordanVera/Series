{"version":3,"sources":["../../source/server/router/routes/tvshow/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import * as express from \"express\";\r\nimport * as mysql from 'mysql';\r\nimport { tmdb_services } from '../../../tmdb/tmdb_services';\r\nimport {config_db} from '../../../config/config_db';\r\nimport * as _ from 'lodash';\r\n\r\nexport class tvshow_routes {\r\n    private _app            : express.Express;\r\n    private _tmdb_services  : tmdb_services; \r\n    private _pool           : any;\r\n\r\n    constructor(app, tmdb_services){\r\n        this._app           = app;\r\n        this._tmdb_services = tmdb_services;\r\n        this._pool          = mysql.createPool(config_db);\r\n        this.setRoutes();\r\n    }\r\n    public setRoutes(){\r\n        this.list_tvshows();\r\n        this.add_tvshow();\r\n        this.del_tvshow();\r\n        this.update_tvshow();\r\n        this.get_tvshow_data();\r\n    }\r\n    private list_tvshows(){\r\n        this._app.get('/list_tvshows',(req, res)=>{\r\n            if(!req.body)\r\n                return res.sendStatus(400);\r\n            else\r\n                this._pool.query('SELECT id_serie, title FROM series', (error, rows, fields) => {\r\n                    if (error)\r\n                        return res.json({success: false, error: error});\r\n                    else\r\n                        //get data api\r\n                        var data =[];\r\n                        rows.forEach((tvshow, index, rows) => {\r\n                            let subject = this._tmdb_services.getTVShowData(tvshow.title);\r\n                            subject.subscribe(\r\n                                (x:any) => {\r\n                                    if(x.total_results === 1){\r\n                                        data.push({\r\n                                            id_serie    : rows[index].id_serie,\r\n                                            title       : rows[index].title,\r\n                                            data        : x.results[0]});\r\n                                    }\r\n                                    else{\r\n                                        let tvshow = _.find(x.results, (o:any)=>{\r\n                                            return (\r\n                                                o.name === rows[index].title &&\r\n                                                o.poster_path.length > 1 &&\r\n                                                o.overview.length > 1\r\n                                            );\r\n                                        });\r\n                                        data.push({\r\n                                                    id_serie    : rows[index].id_serie,\r\n                                                    title       : rows[index].title,\r\n                                                    data        : tvshow});\r\n                                    }\r\n                                },\r\n                                e   => {\r\n                                    data.push({\r\n                                        id_serie    : rows[index].id_serie,\r\n                                        title       : rows[index].title,\r\n                                        data        : e});\r\n                                },\r\n                                ()  => {\r\n                                    if(data.length===rows.length){\r\n                                        return res.json({success:true, result:data});\r\n                                    }\r\n                                });\r\n                        });\r\n                });\r\n        });\r\n    }\r\n    private add_tvshow(){\r\n        this._app.post('/add_tvshow', (req, res) => {\r\n            if(!req.body)\r\n                return res.sendStatus(400);\r\n            else\r\n                this._pool.query('INSERT INTO series (title) VALUES (?)', [req.body.TVShow_name], (error, result) => {\r\n                    if (error) return res.json({success: false, error: error});\r\n                    return res.json({\r\n                        success: true,\r\n                        id_serie: result.insertId\r\n                    }); \r\n                });\r\n        });\r\n    }\r\n    private del_tvshow(){\r\n        this._app.delete('/del_tvshow/:id_serie',(req, res) => {\r\n            if(!req.params)\r\n                return res.sendStatus(400);\r\n            else\r\n                this._pool.query('DELETE FROM series WHERE id_serie = ?', [req.params.id_serie], (error) => {\r\n                    if (error) return res.json({success: false, error: error});\r\n                    return res.json({success: true});\r\n                });\r\n        });\r\n    }\r\n    private update_tvshow(){\r\n        this._app.put('/update_tvshow',(req, res) => {\r\n            if(!req.body){\r\n                return res.sendStatus(400);\r\n            }else{\r\n                this._pool.query('UPDATE series SET title = ? WHERE id_serie = ?', [req.body.nombre, req.body.id_serie], (error) => {\r\n                    if (error) \r\n                        return res.json({success: false, error: error});\r\n                    else\r\n                        return res.json({success:true});\r\n                });\r\n            }\r\n        });\r\n    }\r\n    private get_tvshow_data(){\r\n        this._app.get('/get_tvshow_data/:title', (req, res)=>{\r\n            if(!req.body)\r\n                return res.sendStatus(400)\r\n            else\r\n                var subject : any = this._tmdb_services.getTVShowData(req.params.title);\r\n                subject.subscribe(\r\n                    x   => {\r\n                        if(x.total_results === 1){\r\n                            return res.json({success:true, result:x.results[0]});\r\n                        }                            \r\n                        else{\r\n                            let tvshow = _.find(x.results, (o:any)=>{\r\n                                            return (\r\n                                                o.name === req.params.title &&\r\n                                                o.poster_path.length > 1 &&\r\n                                                o.overview.length > 1\r\n                                            );\r\n                                        });                           \r\n                             return res.json({success:true, result:tvshow});\r\n                        }\r\n                    },\r\n                    e   => {\r\n                        return res.json({success:false, err:e});\r\n                    }\r\n                );\r\n        });\r\n    }\r\n}"]}